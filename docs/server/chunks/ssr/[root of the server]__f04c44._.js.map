{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/Me/source/repos/amexp/src/app/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useState } from 'react';\nimport Image from 'next/image';\nimport Papa from 'papaparse';\nimport { Pie } from 'react-chartjs-2';\nimport { Chart as ChartJS, ArcElement, Tooltip, Legend, ChartData } from 'chart.js';\n\nChartJS.register(ArcElement, Tooltip, Legend);\n\nconst initialChartData: ChartData<\"pie\", number[], unknown> = {\n  labels: [],\n  datasets: [\n    {\n      data: [],\n      backgroundColor: [],\n    },\n  ],\n};\n\nfunction removeExtraSpaces(input: string): string {\n  return input.replace(/\\s+/g, ' ').trim();\n}\n\nfunction formatCurrency(input: number): string {\n  const formatter = new Intl.NumberFormat('it-IT', {\n    style: 'currency',\n    currency: 'EUR',\n    trailingZeroDisplay: 'stripIfInteger'\n  });\n\n  return formatter.format(input)\n}\n\nexport default function Home() {\n  const [file, setFile] = useState(null);\n  const [descCol, setDescCol] = useState('Descrizione');\n  const [amountCol, setAmountCol] = useState('Importo');\n  const [errorMessage, setErrorMessage] = useState('');\n  const [output, setOutput] = useState([]);\n  const [chartData, setChartData] = useState<ChartData<\"pie\", number[], unknown>>(initialChartData);\n\n  const handleFileChange = (event) => {\n    setFile(event.target.files[0]);\n  };\n\n  const handleDescColChange = (event) => {\n    setDescCol(event.target.value);\n  };\n\n  const handleAmountColChange = (event) => {\n    setAmountCol(event.target.value);\n  };\n\n  const handleSubmit = () => {\n    if (!file) {\n      alert('Please upload a CSV file.');\n      return;\n    }\n\n    Papa.parse(file, {\n      header: true,\n      complete: (results) => {\n        try {\n          const data = results.data;\n          const groupedData = groupExpenses(data, descCol, amountCol);\n          setErrorMessage(null)\n          setOutput(groupedData);\n          setChartData(createChartData(groupedData));\n        } catch (error) {\n          setErrorMessage(`Error parsing document: ${error.message}`);\n        }\n      },\n    });\n  };\n\n  const groupExpenses = (data, descCol, amountCol) => {\n    const grouped = data.reduce((acc, row) => {\n      const desc = removeExtraSpaces(row[descCol]);\n      const amount = parseFloat(row[amountCol].replace(',', '.'));\n      if (!isNaN(amount)) {\n        acc[desc] = (acc[desc] || 0) + amount;\n      }\n      return acc;\n    }, {});\n\n    return Object.entries(grouped)//@ts-ignore\n      .map(([description, total]) => ({ description, total: total.toFixed(2) }))\n      .sort((a, b) => b.total - a.total);\n  };\n\n  const createChartData = (groupedData) => {\n    const labels = groupedData.map(item => item.description);\n    const data = groupedData.map(item => parseFloat(item.total));\n    return {\n      labels,\n      datasets: [\n        {\n          label: 'Spese totali',\n          data,\n          backgroundColor: [\n            '#FF6384',\n            '#36A2EB',\n            '#FFCE56',\n            '#4BC0C0',\n            '#9966FF',\n            '#FF9F40',\n          ],\n          hoverOffset: 4,\n        },\n      ],\n    };\n  };\n\n  const totalAmount = output.reduce((acc, item) => acc + parseFloat(item.total), 0).toFixed(2);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-white flex-col\">\n      <div className=\"p-4 mb-2 w-full max-w-4xl flex flex-col\">\n        <div className=\"p-8 text-slate-800 text-center\">\n          <Image\n            src=\"/cc-logo.png\"\n            alt=\"AmExp Logo\"\n            width={50}\n            height={50}\n            className=\"m1 inline h-auto float-left\"\n          />\n          <h1 className=\"text-4xl font-bold mb-2\">\n            <span>&nbsp;AmExp - American Express Expenses</span>\n          </h1>\n          <p className=\"text-lg opacity-90\">\n            Analizza le spese effettuate con amex visualizzandole in un comodo grafico a torta.\n          </p>\n        </div>\n      </div>\n      <div className=\"bg-gradient-to-r from-white to-blue-50 p-8 rounded-lg shadow-md w-full max-w-4xl flex flex-col\">\n        <div className=\"flex flex-col md:flex-row\">\n          {/* Form Section */}\n          <div className=\"md:w-1/2 pr-4 mb-4 md:mb-0\">\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Estratto conto Amex in formato CSV:\n                <input\n                  type=\"file\"\n                  accept=\".csv\"\n                  onChange={handleFileChange}\n                  className=\"w-full border border-gray-300 rounded-md p-2\"\n                />\n              </label>\n            </div>\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Header descrizione spesa:\n                <input\n                  type=\"text\"\n                  value={descCol}\n                  onChange={handleDescColChange}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md p-2\"\n                />\n              </label>\n            </div>\n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Header importo:\n                <input\n                  type=\"text\"\n                  value={amountCol}\n                  onChange={handleAmountColChange}\n                  className=\"mt-1 block w-full border border-gray-300 rounded-md p-2\"\n                />\n              </label>\n            </div>\n            <button\n              onClick={handleSubmit}\n              className=\"w-full bg-blue-600 text-white font-semibold py-2 rounded-md hover:bg-blue-700 transition duration-200\"\n            >\n              Elabora file\n            </button>\n            {errorMessage && (\n              <div className=\"mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded\">\n                <strong>Error:</strong> {errorMessage}\n              </div>\n            )}\n          </div>\n\n          {/* Pie Chart Section */}\n          <div className=\"md:w-1/2 pl-4\">\n            {output.length > 0 && (\n              <div>\n                <h2 className=\"text-xl font-bold mb-2 text-center\">Distribuzione spese</h2>\n                <Pie data={chartData} />\n              </div>\n            )}\n            {output.length > 0 && (\n              <div className=\"text-center mt-2\">\n                <span className=\"text-xl font-bold mb-2 text-center\">Totale: </span>\n                <span className=\"inline-flex items-center justify-center px-3 py-1 text-sm font-bold text-white bg-orange-600 rounded-full\">\n                  {formatCurrency(parseFloat(totalAmount))}\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n      <div className=\"container mx-auto pt-2 text-center\">\n        <p className=\"text-sm\">\n          &copy; {new Date().getFullYear()} AmExp. All rights reserved.\n        </p>\n        <p className=\"text-xs\">\n          Made with ðŸ’¢ by <a href=\"https://github.com/hashcake\" target=\"_blank\">@hashcake</a>\n        </p>\n      </div>\n    </div>\n  );\n\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 423, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}